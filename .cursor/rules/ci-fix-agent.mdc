---
description: AI agent rules for fixing CI/CD build and test errors
alwaysApply: false
---

# CI/CD Fix Agent Rules

## Purpose

This agent automatically fixes build, lint, TypeScript, and test errors detected in CI/CD pipelines.

## Core Principles

1. **Minimal Fixes**: Apply the smallest change necessary to fix the error
2. **No Business Logic Changes**: Only fix technical errors, never change business logic
3. **Preserve Intent**: Don't change code behavior, only fix errors
4. **Test First**: Always verify fixes don't break existing functionality
5. **Document Changes**: Create clear commit messages explaining the fix

## Build Error Fixes

### TypeScript Errors

**When fixing TypeScript errors:**
- Read the error message carefully
- Identify the specific type issue
- Apply minimal type fix (add type annotation, fix import, etc.)
- Never use `any` unless absolutely necessary
- Prefer proper types over type assertions

**Example:**
```typescript
// ❌ Bad fix
const data: any = response;

// ✅ Good fix
const data: UserResponse = response;
```

### Lint Errors

**When fixing lint errors:**
- Read the lint rule explanation
- Apply the suggested fix if safe
- If rule is too strict, disable for specific line with comment
- Never disable entire rules globally

**Example:**
```typescript
// ❌ Bad fix
// eslint-disable-next-line

// ✅ Good fix
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const data: any = legacyApi();
```

### Build Errors

**When fixing build errors:**
- Check for missing dependencies
- Verify import paths
- Check for circular dependencies
- Ensure all required files exist

## Test Error Fixes

### Unit Test Failures

**When fixing test failures:**
1. **Identify the failure:**
   - Read test output
   - Identify which test failed
   - Understand expected vs. actual

2. **Determine fix type:**
   - **Test is wrong**: Update test to match correct behavior
   - **Code is wrong**: Fix code to pass test
   - **Test data is wrong**: Fix test data/fixtures

3. **Apply fix:**
   - Make minimal change
   - Ensure other tests still pass
   - Update test description if behavior changed

**Example:**
```typescript
// ❌ Bad fix - changing test to pass without understanding
it('should calculate total', () => {
  expect(calculateTotal([10, 20])).toBe(25); // Changed from 30 to 25
});

// ✅ Good fix - understanding the issue
it('should calculate total', () => {
  expect(calculateTotal([10, 20])).toBe(30);
  // Fixed calculateTotal() to properly sum items
});
```

### Integration Test Failures

**When fixing integration test failures:**
- Check for environment issues
- Verify API responses
- Check for timing issues
- Ensure test data is correct

### E2E Test Failures

**When fixing E2E test failures:**
1. **Check screenshots/videos:**
   - Review visual evidence
   - Identify UI vs. logic issues

2. **Common fixes:**
   - **Timing issues**: Add proper waits
   - **Selector issues**: Update selectors
   - **Logic issues**: Fix application code
   - **Visual regression**: Update snapshot if intentional

**Example:**
```typescript
// ❌ Bad fix - arbitrary wait
await page.waitForTimeout(5000);

// ✅ Good fix - proper wait
await page.waitForSelector('[data-testid="submit-button"]', { state: 'visible' });
```

## Error Analysis Workflow

### Step 1: Read Error Logs
- Read full error message
- Identify error type (TypeScript, lint, test, build)
- Find file and line number

### Step 2: Understand Root Cause
- Is it a syntax error?
- Is it a type error?
- Is it a logic error?
- Is it a test expectation error?

### Step 3: Determine Fix Strategy
- Can it be auto-fixed? (Yes → proceed)
- Does it require human judgment? (Yes → create PR with analysis)
- Is it a breaking change? (Yes → require manual review)

### Step 4: Apply Fix
- Make minimal change
- Test locally if possible
- Create commit with clear message

### Step 5: Verify Fix
- Re-run CI to verify
- Check other tests still pass
- Ensure no regressions

## Commit Message Format

```
fix(ci): [error type] - [brief description]

[Detailed explanation of the error and fix]

Fixes: [error message or test name]
```

**Example:**
```
fix(ci): TypeScript - Add missing type annotation for UserResponse

The build was failing because the UserResponse type was not imported.
Added the import statement to fix the type error.

Fixes: TS2304: Cannot find name 'UserResponse'
```

## Safety Rules

### Never Do:
- ❌ Change business logic
- ❌ Remove tests
- ❌ Disable linting rules globally
- ❌ Use `any` types unnecessarily
- ❌ Skip error handling
- ❌ Change API contracts
- ❌ Modify database schemas

### Always Do:
- ✅ Make minimal changes
- ✅ Preserve existing behavior
- ✅ Add proper types
- ✅ Update tests if behavior changes
- ✅ Document fixes clearly
- ✅ Verify fixes work

## Integration with CI/CD

This agent is triggered by:
- Build failures
- Lint failures
- TypeScript errors
- Test failures

The agent will:
1. Analyze errors
2. Create fix branch
3. Apply fixes
4. Create PR with explanation
5. Request review

## Related Rules

- `.cursor/rules/testing-standards.mdc` - Testing guidelines
- `.cursor/rules/typescript.mdc` - TypeScript best practices
- `.cursor/rules/ralph.mdc` - Iterative development pattern
