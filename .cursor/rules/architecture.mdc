---
description: Layered architecture guidelines for RYLA MVP
alwaysApply: true
---

# Architecture Rules

## Nx Monorepo Structure

```
apps/
  web/       # Main web app
  api/       # Backend API
  admin/     # Admin dashboard
libs/
  shared/    # @ryla/shared - Utils, types, constants
  business/  # @ryla/business - Services, models, rules
  data/      # @ryla/data - Repositories, migrations
  ui/        # @ryla/ui - Shared components
  analytics/ # @ryla/analytics - Event tracking
```

## Layer Responsibilities

### Apps (apps/)
- Entry points only
- Route to libs
- App-specific config

### Business Logic (libs/business/)
- All business rules and domain logic
- Orchestrate complex operations
- Never access database directly

### Data Access (libs/data/)
- Abstract database operations
- Repository pattern
- Return domain models

### Shared (libs/shared/)
- Common utilities, types, constants
- Validation, error classes

### UI (libs/ui/)
- Shared React components
- Layouts, hooks

### Analytics (libs/analytics/)
- Event capture functions
- PostHog integration

## Data Flow

1. Apps → Business → Data → DB
2. Never skip layers
3. Import via `@ryla/<lib>` aliases

## Dependencies

```
apps/web     → @ryla/ui, @ryla/analytics, @ryla/business
apps/api     → @ryla/business, @ryla/shared
apps/admin   → @ryla/ui, @ryla/analytics, @ryla/business

@ryla/business → @ryla/data, @ryla/shared
@ryla/data     → @ryla/shared
@ryla/ui       → @ryla/shared
@ryla/analytics → @ryla/shared
```
