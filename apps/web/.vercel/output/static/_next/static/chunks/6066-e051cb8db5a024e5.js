"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6066],{65759:function(e,t,a){a.d(t,{HA:function(){return u},O5:function(){return l},XX:function(){return c},ao:function(){return d},hE:function(){return s},uQ:function(){return o}});var r=a(42063);let n=a(72164).env.NEXT_PUBLIC_API_URL||"http://localhost:3001";function i(e){return"cozy-at-home"===e?"cozy_home":e.replace(/-/g,"_")}async function o(e){let t=(e.outfit,e.outfit),a=await (0,r.SH)(`${n}/image/generate/studio`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({characterId:e.characterId,additionalDetails:e.additionalDetails,scene:i(e.scene),environment:i(e.environment),outfit:t,poseId:e.poseId,lighting:e.lighting,expression:e.expression,aspectRatio:e.aspectRatio,count:e.count,nsfw:e.nsfw,promptEnhance:e.promptEnhance,seed:e.seed,modelProvider:e.modelProvider,modelId:e.modelId,isRetry:e.isRetry,retryImageId:e.retryImageId})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.message||e.messages?.[0]||"Failed to start Studio generation")}return a.json()}async function l(e){let t=await (0,r.SH)(`${n}/image/edit/inpaint`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||e.messages?.[0]||"Failed to start inpaint edit")}return t.json()}async function s(e){let t=await (0,r.SH)(`${n}/image/comfyui/${e}/results`);if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||e.messages?.[0]||"Failed to fetch ComfyUI results")}return t.json()}async function c(e){let t=await (0,r.SH)(`${n}/image-gallery/characters/${e}/images`);if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||e.messages?.[0]||"Failed to fetch character images")}return(await t.json()).images??[]}async function u(e){let t=await (0,r.SH)(`${n}/image-gallery/images/${e}/like`,{method:"POST"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||e.messages?.[0]||"Failed to like image")}return{liked:!!(await t.json()).liked}}async function d(e){let t=await (0,r.SH)(`${n}/image-gallery/images/${e}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||e.messages?.[0]||"Failed to delete image")}}},96066:function(e,t,a){a.d(t,{Bg:function(){return r.Bg},RV:function(){return u},M0:function(){return s},mU:function(){return n.m}});var r=a(29289),n=a(237);a(23599);var i=a(27905),o=a(65759);let l=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;function s(e){let{selectedInfluencerId:t,influencers:a,pollInterval:r=2e3,staleThreshold:n=6e4}=e,[s,c]=i.useState([]),[u,d]=i.useState(!1),[f,m]=i.useState(new Set),g=i.useRef(null),h=i.useMemo(()=>a.filter(e=>{var t;return t=e.id,l.test(t)}),[a]),y=i.useCallback(()=>{let e=Date.now();c(t=>{let a=!1,r=t.map(t=>"generating"!==t.status?t:e-new Date(t.createdAt).getTime()>n?(a=!0,{...t,status:"failed"}):t);return a?r:t})},[n]),w=i.useRef(h);i.useEffect(()=>{w.current=h},[h]);let p=i.useCallback(async e=>{if(!l.test(e)){c([]),d(!1),g.current=null;return}if(g.current!==e){g.current=e,0===s.length&&d(!0);try{let t=await (0,o.XX)(e),a=w.current.find(t=>t.id===e),r=t.map(t=>({id:t.id,imageUrl:t.s3Url||"",thumbnailUrl:t.thumbnailUrl||void 0,influencerId:e,influencerName:a?.name||"Unknown",influencerAvatar:a?.avatar||void 0,prompt:t.prompt||void 0,scene:t.scene||void 0,environment:t.environment||void 0,outfit:t.outfit||void 0,poseId:t.poseId||void 0,aspectRatio:t.aspectRatio||"9:16",status:"completed"===t.status?"completed":"failed"===t.status?"failed":"generating",createdAt:t.createdAt||new Date().toISOString(),isLiked:!!t.liked,nsfw:t.nsfw??!1,promptEnhance:t.promptEnhance??void 0,originalPrompt:t.originalPrompt||void 0,enhancedPrompt:t.enhancedPrompt||void 0}));c(t=>{let a=I.current,i=Date.now(),o=new Map(t.map(e=>[e.id,e])),l=t.filter(t=>{if(!t.id.startsWith("placeholder-"))return!1;let n=t.id.replace("placeholder-","");return!!(t.influencerId!==e||a.has(n))||!r.some(e=>e.id===n||"generating"===e.status||"completed"===e.status)});return[...r.map(e=>{let t=o.get(e.id);return t?t.status!==e.status||t.imageUrl!==e.imageUrl||t.thumbnailUrl!==e.thumbnailUrl||t.isLiked!==e.isLiked||t.nsfw!==e.nsfw?e:t:e}),...l].map(e=>{if("generating"!==e.status)return e;let t=new Date(e.createdAt).getTime();return i-t>n?{...e,status:"failed"}:e})})}finally{g.current===e&&(d(!1),g.current=null)}}},[n]),k=i.useCallback(e=>{c(t=>[...e,...t])},[]),S=i.useCallback((e,t)=>{c(a=>{let r=!1,n=a.map(a=>a.id===e&&Object.keys(t).some(e=>a[e]!==t[e])?(r=!0,{...a,...t}):a);return r?n:a})},[]),v=i.useCallback(e=>{c(t=>t.filter(t=>t.id!==e))},[]),b=i.useCallback((e,t)=>{c(a=>{let r=a.findIndex(t=>t.id===e);if(-1===r)return[t,...a];let n=[...a];return n[r]=t,n})},[]);i.useEffect(()=>{t&&p(t).catch(e=>console.error("Failed to load images:",e))},[t,p]),i.useEffect(()=>{y();let e=setInterval(y,3e4);return()=>clearInterval(e)},[y]);let I=i.useRef(f);i.useEffect(()=>{I.current=f},[f]);let E=i.useMemo(()=>s.some(e=>"generating"===e.status&&!e.id.startsWith("placeholder-")),[s]);return i.useEffect(()=>{if(f.size>0||!E||!t)return;let e=setInterval(async()=>{try{await p(t)}catch(e){console.error("Fallback polling error:",e)}},1e4);return()=>clearInterval(e)},[E,t,f.size,p]),{images:s,isLoading:u,refreshImages:p,addPlaceholders:k,updateImage:S,replaceImage:b,removeImage:v,activeGenerations:f,setActiveGenerations:m}}var c=a(22548);function u(){let[e,t]=i.useState(""),[a,r]=(0,c._)("ryla-gallery-view-mode","grid"),[n,o]=(0,c._)("ryla-gallery-aspect-ratio","all"),l=i.useMemo(()=>"string"==typeof n?"all"===n?[]:[n]:Array.isArray(n)?n:[],[n]);i.useEffect(()=>{"string"==typeof n&&o("all"===n?[]:[n])},[n,o]);let s=i.useCallback(e=>{o(e)},[o]),[u,d]=(0,c._)("ryla-gallery-status","all"),[f,m]=(0,c._)("ryla-gallery-liked","all"),[g,h]=(0,c._)("ryla-gallery-adult","all"),[y,w]=(0,c._)("ryla-gallery-sort-by","newest"),[p,k]=(0,c._)("ryla-gallery-show-panel",!0),S=i.useCallback(t=>{let a=[...t];if(e.trim()){let t=e.toLowerCase();a=a.filter(e=>e.prompt?.toLowerCase().includes(t)||e.influencerName?.toLowerCase().includes(t)||e.scene?.toLowerCase().includes(t)||e.environment?.toLowerCase().includes(t))}return l.length>0&&(a=a.filter(e=>l.includes(e.aspectRatio))),"all"!==u&&(a=a.filter(e=>e.status===u)),"liked"===f?a=a.filter(e=>e.isLiked):"not-liked"===f&&(a=a.filter(e=>!e.isLiked)),"not-adult"===g?a=a.filter(e=>!e.nsfw):"adult"===g&&(a=a.filter(e=>e.nsfw)),a.sort((e,t)=>"newest"===y?new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime():"oldest"===y?new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime():0),a},[e,l,u,f,g,y]),v=i.useCallback(()=>{t(""),s([]),d("all"),m("all"),h("all"),w("newest")},[s,d,m,h,w]);return{viewMode:a,setViewMode:r,aspectRatios:l,setAspectRatios:s,status:u,setStatus:d,liked:f,setLiked:m,adult:g,setAdult:h,sortBy:y,setSortBy:w,searchQuery:e,setSearchQuery:t,showPanel:p,setShowPanel:k,filterImages:S,resetFilters:v}}a(46369)},29289:function(e,t,a){a.d(t,{Bg:function(){return i}});var r=a(63609),n=a(42063);function i(){let e=(0,n.hP)(),{data:t,isLoading:a,error:i,refetch:o}=r.SX.credits.getBalance.useQuery(void 0,{enabled:!!e,refetchInterval:!!e&&3e4,placeholderData:e=>e,retry:(e,t)=>{if(e>=3)return!1;let a=t?.data?.httpStatus;return 401!==a&&403!==a}}),l=r.SX.credits.dismissLowBalanceWarning.useMutation({onSuccess:()=>{o()}});return{balance:t?.balance??0,totalEarned:t?.totalEarned??0,totalSpent:t?.totalSpent??0,isLowBalance:t?.isLowBalance??!1,isZeroBalance:t?.isZeroBalance??!1,lowBalanceThreshold:t?.lowBalanceThreshold??10,lowBalanceWarningShown:t?.lowBalanceWarningShown??null,isLoading:a,error:i,refetch:o,dismissLowBalanceWarning:()=>l.mutate(),isDismissing:l.isPending}}},22548:function(e,t,a){a.d(t,{_:function(){return n}});var r=a(27905);function n(e,t){let[a,n]=r.useState(()=>{try{let a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(a){return console.warn(`Failed to load ${e} from localStorage:`,a),t}}),i=r.useCallback(t=>{try{let r=t instanceof Function?t(a):t;n(r),window.localStorage.setItem(e,JSON.stringify(r))}catch(t){console.warn(`Failed to save ${e} to localStorage:`,t)}},[e,a]);return[a,i]}},46369:function(e,t,a){a.d(t,{G5:function(){return h},QV:function(){return v},Qs:function(){return f},YA:function(){return m},_B:function(){return d},hG:function(){return w},id:function(){return k}});var r=a(24728),n=a(25640),i=a(42141),o=a(42063);let l=a(72164).env.NEXT_PUBLIC_API_URL||"http://localhost:3001";async function s(e){let t=await (0,o.SH)(`${l}/characters/${e}/lora`);if(!t.ok){if(404===t.status)return{lora:null,loraEnabled:!1};throw Error("Failed to fetch LoRA status")}return t.json()}async function c(e){let t=await (0,o.SH)(`${l}/characters/train-lora`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||"Failed to start LoRA training");return t.json()}async function u(e){let t=await (0,o.SH)(`${l}/characters/${e}/lora/available-images`);if(!t.ok)throw Error("Failed to fetch available images");return t.json()}function d(e){return(0,r.a)({queryKey:["characterLora",e],queryFn:()=>s(e),enabled:!!e,refetchInterval:e=>{let t=e.state.data;return(t?.lora?.status==="training"||t?.lora?.status==="pending")&&1e4}})}function f(){let e=(0,n.NL)();return(0,i.D)({mutationFn:c,onSuccess:(t,a)=>{e.invalidateQueries({queryKey:["characterLora",a.characterId]}),e.invalidateQueries({queryKey:["myLoras"]})}})}function m(e){return(0,r.a)({queryKey:["availableTrainingImages",e],queryFn:()=>u(e),enabled:!!e})}async function g(){let e=await (0,o.SH)(`${l}/characters/lora-model-types`);if(!e.ok)throw Error("Failed to fetch model types");return e.json()}function h(){return(0,r.a)({queryKey:["loraModelTypes"],queryFn:g,staleTime:36e5})}async function y(e){let t=await (0,o.SH)(`${l}/characters/${e.characterId}/lora/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e.enabled})});if(!t.ok)throw Error("Failed to toggle LoRA setting");return t.json()}function w(){let e=(0,n.NL)();return(0,i.D)({mutationFn:y,onSuccess:(t,a)=>{e.invalidateQueries({queryKey:["characterLora",a.characterId]}),e.invalidateQueries({queryKey:["character",a.characterId]})}})}async function p(e){let t=await (0,o.SH)(`${l}/characters/${e}/lora/history`);if(!t.ok)throw Error("Failed to fetch training history");return t.json()}function k(e){return(0,r.a)({queryKey:["trainingHistory",e],queryFn:()=>p(e),enabled:!!e})}async function S(e){let t=await (0,o.SH)(`${l}/characters/${e}/lora/new-images-check`);if(!t.ok)throw Error("Failed to check new liked images");return t.json()}function v(e){return(0,r.a)({queryKey:["newLikedImagesCheck",e],queryFn:()=>S(e),enabled:!!e,staleTime:3e5})}},23599:function(e,t,a){a.d(t,{z:function(){return i}});var r=a(63609),n=a(42063);function i(e){let t=e?.limit??20,a=e?.offset??0,i=(0,n.hP)(),o=r.SX.useUtils(),l=r.SX.notifications.list.useQuery({limit:t,offset:a},{enabled:!!i,refetchInterval:!!i&&(e?.refetchIntervalMs??3e4),placeholderData:e=>e,retry:(e,t)=>{if(e>=3)return!1;let a=t?.data?.httpStatus;return 401!==a&&403!==a}}),s=r.SX.notifications.markAllRead.useMutation({onSuccess:()=>{o.notifications.list.invalidate()}}),c=r.SX.notifications.markRead.useMutation({onSuccess:()=>{o.notifications.list.invalidate()}});return{items:l.data?.items??[],total:l.data?.total??0,unreadCount:l.data?.unreadCount??0,limit:l.data?.limit??t,offset:l.data?.offset??a,isLoading:l.isLoading,error:l.error,refetch:l.refetch,markAllRead:()=>s.mutate(),isMarkingAllRead:s.isPending,markRead:e=>c.mutate({notificationId:e}),isMarkingRead:c.isPending}}}}]);