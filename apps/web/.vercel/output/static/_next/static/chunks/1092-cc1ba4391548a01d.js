"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1092],{16557:function(e,t,r){r.d(t,{i:function(){return i}});var a=r(43264);r(27905);var l=r(8339),s=r(37948),n=r(54055);function i(e){let{image:t,isOpen:r,onClose:i}=e,o=(0,n.dD)();return r&&t&&"skeleton"!==t.url&&"loading"!==t.url?(0,a.jsxs)("div",{className:"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-black/95 backdrop-blur-md animate-in fade-in duration-300",onClick:i,children:[(0,a.jsx)("button",{onClick:i,className:"absolute top-6 right-6 z-[110] flex h-12 w-12 items-center justify-center rounded-full bg-white/10 text-white/80 transition-all hover:bg-white/20 hover:text-white active:scale-95","aria-label":"Close lightbox",children:(0,a.jsx)(s.Z,{className:"h-6 w-6"})}),(0,a.jsx)("div",{className:(0,n.cn)("relative flex items-center justify-center transition-all duration-500",o?"w-full h-full p-4":"max-w-[90vw] max-h-[85vh] w-full h-[85vh]"),onClick:e=>e.stopPropagation(),children:(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)(l.default,{src:t.url,alt:`Base image ${t.model?`- ${t.model}`:""}`,fill:!0,className:"object-contain animate-in zoom-in-95 duration-300",priority:!0})})}),!o&&t.model&&(0,a.jsx)("div",{className:"absolute bottom-10 left-0 right-0 px-10 flex justify-center pointer-events-none",children:(0,a.jsx)("div",{className:"max-w-2xl bg-black/40 backdrop-blur-sm rounded-2xl p-4 text-center pointer-events-auto border border-white/10",children:(0,a.jsx)("p",{className:"text-sm text-white/70",children:t.model})})})]}):null}},34268:function(e,t,r){r.d(t,{F:function(){return k}});var a=r(43264),l=r(27905),s=r(97720),n=r(34195);function i(e,t){let{fineTuneAdjustment:r,skipCreditDeduction:a}="string"==typeof t?{fineTuneAdjustment:t}:t||{};if("prompt-based"===e.creationMethod&&e.promptInput){let t=e.promptInput.trim();return r?.trim()&&(t=`${t}. Additional adjustments: ${r.trim()}`),{promptInput:t,promptEnhance:e.promptEnhance??!0,nsfwEnabled:e.nsfwEnabled||!1,...a&&{skipCreditDeduction:!0}}}return{appearance:{gender:"female"===e.gender||"male"===e.gender?e.gender:"female",style:"realistic"===e.style||"anime"===e.style?e.style:"realistic",ethnicity:e.ethnicity||"caucasian",age:e.age||25,...e.ageRange&&{ageRange:e.ageRange},...e.skinColor&&{skinColor:e.skinColor},eyeColor:e.eyeColor||"brown",...e.faceShape&&{faceShape:e.faceShape},hairStyle:e.hairStyle||"long-straight",hairColor:e.hairColor||"brown",bodyType:e.bodyType||"slim",...e.assSize&&{assSize:e.assSize},...e.breastSize&&{breastSize:e.breastSize},...e.breastType&&{breastType:e.breastType},...e.freckles&&{freckles:e.freckles},...e.scars&&{scars:e.scars},...e.beautyMarks&&{beautyMarks:e.beautyMarks},...e.piercings&&{piercings:e.piercings},...e.tattoos&&{tattoos:e.tattoos}},identity:{defaultOutfit:e.outfit||"casual",archetype:e.archetype||"girl-next-door",personalityTraits:e.personalityTraits.length>0?e.personalityTraits:["friendly"],bio:e.bio||""},nsfwEnabled:e.nsfwEnabled||!1,...r?.trim()&&{promptInput:r.trim(),promptEnhance:!1},...a&&{skipCreditDeduction:!0}}}var o=r(8339),c=r(11942),d=r(15421),u=r(94483),m=r(54055);function h(e){let{image:t,index:r,isSelected:l,isRegenerating:s,isSkeleton:n,onSelect:i,onRegenerate:h,onViewFull:g}=e,p=(0,m.dD)(),x="failed"===t.url||"error"===t.url;return n?(0,a.jsx)("div",{className:"relative rounded-xl overflow-hidden border-2 border-white/10 bg-white/5",children:(0,a.jsxs)("div",{className:"relative aspect-square",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-white/5 to-white/10 animate-pulse",children:(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer"})}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-purple-500/30 border-t-purple-500 rounded-full animate-spin"})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2.5",children:(0,a.jsx)("div",{className:"h-3 w-16 bg-white/20 rounded animate-pulse"})})]})}):x?(0,a.jsx)("div",{className:(0,m.cn)("relative group rounded-xl overflow-hidden border-2 transition-all cursor-pointer","border-red-500/50 bg-red-950/20"),onClick:i,children:(0,a.jsxs)("div",{className:"relative aspect-square bg-red-950/30",children:[(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-4 text-center",children:[(0,a.jsx)(c.Z,{className:"w-12 h-12 md:w-16 md:h-16 text-red-400 mb-3"}),(0,a.jsx)("p",{className:"text-red-300 text-xs md:text-sm font-semibold mb-1",children:"Generation Failed"}),t.error&&(0,a.jsx)("p",{className:"text-red-400/70 text-[10px] md:text-xs line-clamp-2",children:t.error})]}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/60 to-transparent p-2.5 z-10",children:(0,a.jsxs)("p",{className:"text-white text-[10px] md:text-sm font-semibold truncate",children:["#",r+1," - Failed"]})}),(0,a.jsx)("div",{className:"absolute top-2 left-2 z-20",children:(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),h()},className:(0,m.cn)("w-8 h-8 md:w-9 md:h-9 rounded-lg bg-black/60 backdrop-blur-md flex items-center justify-center text-white border border-white/10 shadow-lg transition-all hover:bg-black/80 active:scale-90",!p&&"opacity-0 group-hover:opacity-100"),"aria-label":"Regenerate this image",children:(0,a.jsx)(d.Z,{className:"w-4 h-4 md:w-[18px] md:h-[18px]"})})})]})}):(0,a.jsx)("div",{className:(0,m.cn)("relative group rounded-xl overflow-hidden border-2 transition-all cursor-pointer",l?"border-purple-400 ring-2 ring-purple-400/30":"border-white/10 hover:border-white/20",s&&"opacity-60"),onClick:i,children:(0,a.jsx)("div",{className:"relative aspect-square bg-white/5",children:s?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/5",children:(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-purple-500/20 border-t-purple-500 rounded-full animate-spin"})}):(0,a.jsxs)(a.Fragment,{children:[t.url&&(t.url.startsWith("http")||t.url.startsWith("data:"))?(0,a.jsx)(o.default,{src:t.url,alt:`Base image ${r+1}`,fill:!0,className:"object-cover transition-transform duration-300 group-hover:scale-105"}):(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/5",children:(0,a.jsx)("p",{className:"text-white/40 text-xs",children:"Invalid image URL"})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/60 to-transparent p-2.5 z-10",children:(0,a.jsxs)("p",{className:"text-white text-[10px] md:text-sm font-semibold truncate",children:["#",r+1,t.model?` - ${t.model}`:""]})}),l&&(0,a.jsx)("div",{className:"absolute top-2 right-2 w-7 h-7 md:w-8 md:h-8 rounded-full bg-purple-500 flex items-center justify-center ring-2 ring-purple-500/30 shadow-lg z-20",children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",className:"w-4 h-4 md:w-5 md:h-5 text-white",children:(0,a.jsx)("path",{d:"M5 13l4 4L19 7",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,a.jsxs)("div",{className:"absolute top-2 left-2 flex items-center gap-1.5 z-20",children:[g&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),g()},className:(0,m.cn)("w-8 h-8 md:w-9 md:h-9 rounded-lg bg-black/60 backdrop-blur-md flex items-center justify-center text-white border border-white/10 shadow-lg transition-all hover:bg-black/80 active:scale-90",!p&&"opacity-0 group-hover:opacity-100"),"aria-label":"View full size",children:(0,a.jsx)(u.Z,{className:"w-4 h-4 md:w-[18px] md:h-[18px]"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),h()},className:(0,m.cn)("w-8 h-8 md:w-9 md:h-9 rounded-lg bg-black/60 backdrop-blur-md flex items-center justify-center text-white border border-white/10 shadow-lg transition-all hover:bg-black/80 active:scale-90",!p&&"opacity-0 group-hover:opacity-100"),"aria-label":"Regenerate this image",children:(0,a.jsx)(d.Z,{className:"w-4 h-4 md:w-[18px] md:h-[18px]"})})]}),(0,a.jsx)("div",{className:(0,m.cn)("absolute inset-0 bg-black/0 transition-colors pointer-events-none",!l&&"group-hover:bg-black/10")})]})})})}var g=r(16557);function p(e){let{selectedImageId:t,fineTunePrompt:r,onFineTunePromptChange:l,onRegenerate:s,isGenerating:n,fineTuningImageId:i}=e;return t?(0,a.jsx)("div",{className:"w-full mb-4",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-white/8 to-white/4 border border-white/10 rounded-2xl p-5 shadow-lg backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",className:"w-4 h-4 text-purple-400",children:[(0,a.jsx)("path",{d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z",stroke:"currentColor",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z",stroke:"currentColor",strokeWidth:"1.5"})]}),(0,a.jsx)("p",{className:"text-white/70 text-sm font-medium",children:"Fine-tune Selected Image"})]}),(0,a.jsx)(m.gx,{value:r,onChange:e=>l(e.target.value),placeholder:"Describe adjustments, e.g., 'make eyes brighter', 'softer expression', 'warmer lighting', 'add subtle smile'...",className:"min-h-[80px] bg-white/5 border-white/10 text-white placeholder:text-white/40 rounded-xl resize-none focus:border-purple-500/50 focus:ring-purple-500/20 text-sm",maxLength:500}),(0,a.jsx)("div",{className:"flex items-center justify-between mt-2",children:(0,a.jsxs)("span",{className:"text-white/30 text-xs",children:[r.length,"/500"]})}),(0,a.jsx)("button",{onClick:s,disabled:n||null!==i||!r.trim(),className:(0,m.cn)("mt-3 w-full px-4 py-2.5 rounded-xl text-sm font-medium transition-all relative overflow-hidden",r.trim()&&!n&&null===i?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/25 hover:shadow-purple-500/40":"bg-white/10 text-white/40 cursor-not-allowed"),children:i===t?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Regenerating..."]}):"Regenerate with Adjustments"})]})}):null}function x(e){let{isGenerating:t,hasSkeletonImages:r,completedCount:l,expectedImageCount:s}=e;return(0,a.jsxs)("div",{className:"text-center mb-8 w-full",children:[(0,a.jsx)("p",{className:"text-white/60 text-sm font-medium mb-2",children:"Base Image Selection"}),(0,a.jsx)("h1",{className:"text-white text-2xl font-bold mb-2",children:"Choose Your Character Face"}),t||r?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-3",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-purple-500 animate-pulse"}),(0,a.jsxs)("p",{className:"text-white/60 text-sm",children:["Generating ",l,"/",s," images..."]})]}):(0,a.jsx)("p",{className:"text-white/40 text-sm mt-2",children:"Select one image, or fine-tune and regenerate"})]})}function f(){return(0,a.jsx)("div",{className:"w-full mb-6",children:(0,a.jsx)("div",{className:"bg-gradient-to-br from-orange-500/10 to-amber-500/10 border border-orange-500/20 rounded-2xl p-5",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",className:"w-6 h-6 text-orange-400 flex-shrink-0 mt-0.5",children:(0,a.jsx)("path",{d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-orange-300 font-medium mb-1",children:"Generation not started"}),(0,a.jsx)("p",{className:"text-white/60 text-sm mb-3",children:"Please go back to the prompt input step and click Continue to start generating your character images."}),(0,a.jsx)("button",{onClick:()=>window.history.back(),className:"px-4 py-2 rounded-lg bg-orange-500/20 text-orange-300 text-sm font-medium hover:bg-orange-500/30 transition-colors",children:"â† Go Back to Prompt"})]})]})})})}function b(e){let{images:t,expectedImageCount:r,selectedBaseImageId:s,fineTuningImageId:n,missingJobIds:i,onSelectImage:o,onRegenerateImage:c}=e,[d,u]=l.useState(null),[m,p]=l.useState(!1),x=l.useCallback(e=>{u(e),p(!0)},[]),f=l.useCallback(()=>{p(!1),setTimeout(()=>u(null),300)},[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-full mb-6",children:(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:!i&&t.length>0?t.map((e,t)=>{let r=s===e.id,l=n===e.id||"loading"===e.url,i="skeleton"===e.url,d="failed"===e.url||"error"===e.url,u=!i&&!l&&!d;return(0,a.jsx)(h,{image:e,index:t,isSelected:r,isRegenerating:l,isSkeleton:i,onSelect:()=>u&&o(e.id),onRegenerate:()=>c(e.id),onViewFull:u?()=>x(e):void 0},e.id)}):i?null:Array.from({length:r}).map((e,t)=>(0,a.jsx)(h,{image:{id:`placeholder-${t}`,url:"skeleton",thumbnailUrl:"skeleton"},index:t,isSelected:!1,isRegenerating:!1,isSkeleton:!0,onSelect:()=>{},onRegenerate:()=>{}},`placeholder-${t}`))})}),(0,a.jsx)(g.i,{image:d,isOpen:m,onClose:f})]})}function w(e){let{onRegenerateAll:t,isGenerating:r,isRegeneratingAll:l}=e;return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("button",{onClick:t,disabled:r||l,className:(0,m.cn)("w-full min-h-[44px] px-4 py-3 rounded-xl text-sm font-semibold transition-all",r||l?"bg-white/5 text-white/40 cursor-not-allowed":"bg-white/10 text-white hover:bg-white/20 active:scale-[0.98]"),children:l?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Regenerating All..."]}):"Regenerate All"})})}function y(e){let{error:t,connectionError:r,onRetry:l}=e;return t?(0,a.jsx)("div",{className:"w-full mt-4 p-4 rounded-xl bg-red-500/10 border border-red-500/20",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsx)("p",{className:"text-red-400 text-sm flex-1",children:t}),r&&l&&(0,a.jsxs)("button",{onClick:l,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 text-red-300 text-sm font-medium transition-colors",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"Retry"]})]})}):null}function j(e){let{hasImages:t,isGenerating:r,hasImagesInStore:l,onGenerate:s}=e;return t||r||l?null:(0,a.jsxs)("div",{className:"w-full text-center py-12",children:[(0,a.jsx)("p",{className:"text-white/60 text-sm mb-4",children:"No base images generated yet"}),(0,a.jsx)("button",{onClick:s,className:"px-6 py-2.5 rounded-lg bg-gradient-to-r from-purple-500/80 to-pink-500/80 text-white text-sm font-medium hover:from-purple-500 hover:to-pink-500 transition-all",children:"Generate Base Images"})]})}function k(){let e="prompt-based"===(0,s.useCharacterWizardStore)(e=>e.form).creationMethod,{isGenerating:t,isPolling:r,completedCount:o,error:c,connectionError:d,isRegeneratingAll:u,hasValidImages:m,expectedImageCount:h,pollExistingJobs:g,handleGenerateAll:k,handleRegenerateImage:v}=function(){let{expectedImageCount:e=6}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,s.useCharacterWizardStore)(e=>e.form),r=(0,s.useCharacterWizardStore)(e=>e.baseImages);(0,s.useCharacterWizardStore)(e=>e.baseImageAllJobIds);let a=(0,s.useCharacterWizardStore)(e=>e.setBaseImages),o=(0,s.useCharacterWizardStore)(e=>e.clearBaseImageJobIds),c=(0,s.useCharacterWizardStore)(e=>e.selectBaseImage),[d,u]=l.useState(!1),[m,h]=l.useState(!1),[g,p]=l.useState(0),[x,f]=l.useState(null),[b,w]=l.useState(!1),[y,j]=l.useState(!1),k=l.useRef(0),v=l.useMemo(()=>Array.isArray(r)?r:[],[r]),N=l.useMemo(()=>!!Array.isArray(v)&&0!==v.length&&v.some(e=>e.url&&"skeleton"!==e.url&&"loading"!==e.url&&(e.url.startsWith("http")||e.url.startsWith("data:"))),[v]),C=l.useCallback(()=>{let t=[];for(let r=0;r<e;r++)t.push({id:`skeleton-base-${r}`,url:"skeleton",thumbnailUrl:"skeleton"});return t},[e]),S=l.useCallback(async e=>{if(m||N)return;h(!0),u(!0),f(null),p(0),a(Array.from({length:e.length},(e,t)=>({id:`skeleton-base-${t}`,url:"skeleton",thumbnailUrl:"skeleton"})));let t=[],r=new Map(e.map((e,t)=>[e,t])),l=Date.now();try{for(;r.size>0&&Date.now()-l<6e5;){let e=Array.from(r.keys()).map(async e=>{try{let t=await (0,n.WL)(e);return{jobId:e,result:t}}catch(t){return console.error(`Failed to poll job ${e}:`,t),{jobId:e,result:null,error:t}}});for(let{jobId:l,result:n,error:i}of(await Promise.all(e))){let e=r.get(l);if(void 0===e)continue;let o=s.useCharacterWizardStore.getState().baseImages,c=Array.isArray(o)?o:[];if(i||!n){let t=[...c];t[e]&&(t[e]={id:`failed-${l}`,url:"failed",thumbnailUrl:"failed"},a(t)),r.delete(l);continue}if("completed"===n.status&&n.images&&n.images.length>0)n.images.forEach(r=>{t.push(r);let l=[...c];if(l[e])l[e]=r,a(l);else{let e=l.findIndex(e=>"skeleton"===e.url);-1!==e&&(l[e]=r,a(l))}}),r.delete(l),p(e=>e+1);else if("failed"===n.status){let t=[...c];t[e]&&(t[e]={id:`failed-${l}`,url:"failed",thumbnailUrl:"failed",error:n.error||"Generation failed"},a(t)),r.delete(l)}else if("in_progress"===n.status||"queued"===n.status)continue}r.size>0&&await new Promise(e=>setTimeout(e,2e3))}if(r.size>0){console.warn(`Some base image jobs timed out: ${Array.from(r.keys()).join(", ")}`);let e=s.useCharacterWizardStore.getState().baseImages,t=[...Array.isArray(e)?e:[]];for(let[e,a]of r.entries())t[a]&&(t[a]={id:`timeout-${e}`,url:"failed",thumbnailUrl:"failed",error:"Job timed out"});a(t)}}catch(e){console.error("Polling failed:",e),f(e instanceof Error?e.message:"Failed to get generation results")}finally{h(!1),u(!1)}},[m,N,a]),I=l.useCallback(async function(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(d||m){console.warn("Generation already in progress, skipping duplicate request");return}l&&(k.current=0,j(!1),f(null)),u(!0),f(null),p(0),c(null),o(),a(C()),r&&w(!0);let h=[1e3,2e3,4e3];try{let r=i(t,{skipCreditDeduction:!0});await (0,n.uy)(r,e=>{"completed"===e?(u(!1),w(!1),k.current=0,j(!1)):"failed"===e&&(u(!1),w(!1))},(t,r)=>{let l=s.useCharacterWizardStore.getState().baseImages,n=Array.isArray(l)?l:[];if(r>=0&&r<n.length&&n[r]?.url==="skeleton"){let e=[...n];e[r]=t,a(e)}else{let r=n.findIndex(e=>"skeleton"===e.url);if(-1!==r){let e=[...n];e[r]=t,a(e)}else n.length<e&&a([...n,t])}p(e=>e+1)}),k.current=0,j(!1)}catch(a){console.error("Generation failed:",a);let e=a instanceof Error?a.message:"Generation failed",t=e.includes("ERR_CONNECTION_REFUSED")||e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("connection");if(t&&k.current<3){k.current+=1;let e=h[k.current-1]||h[h.length-1];console.log(`Connection error, retrying (${k.current}/3) after ${e}ms...`),setTimeout(()=>{I(r,!1)},e),f(`Connection failed. Retrying... (${k.current}/3)`);return}t?(j(!0),f("Unable to connect to server. Please check your connection and try again.")):f(e),u(!1),w(!1),k.current=0}},[t,c,o,a,C,e,d,m]),z=l.useCallback(async(e,r,a,l,s)=>{let o=v.find(t=>t.id===e);if(o){f(null),r(e,{...o,url:"loading",thumbnailUrl:"loading"});try{let o=i(t,{fineTuneAdjustment:s,skipCreditDeduction:!0}),c=await (0,n.uy)(o,()=>{});c.length>0&&(r(e,c[0]),l===e&&a(c[0].id))}catch(t){console.error("Regeneration failed:",t),f(t instanceof Error?t.message:"Regeneration failed"),r(e,o)}}},[t,v]);return{isGenerating:d,isPolling:m,completedCount:g,error:x,setError:f,connectionError:y,isRegeneratingAll:b,hasValidImages:N,safeBaseImages:v,expectedImageCount:e,pollExistingJobs:S,handleGenerateAll:I,handleRegenerateImage:z}}(),{fineTuningImageId:N,safeBaseImages:C,skeletonImages:S,hasImages:I,selectedBaseImageId:z,baseImageFineTunePrompt:R,setBaseImageFineTunePrompt:E,selectBaseImage:W,handleRegenerateSingleImage:A,handleFineTuneAndRegenerate:M}=function(e){let{handleRegenerateImage:t}=e,r=(0,s.useCharacterWizardStore)(e=>e.selectedBaseImageId),a=(0,s.useCharacterWizardStore)(e=>e.baseImageFineTunePrompt),n=(0,s.useCharacterWizardStore)(e=>e.selectBaseImage),i=(0,s.useCharacterWizardStore)(e=>e.setBaseImageFineTunePrompt),o=(0,s.useCharacterWizardStore)(e=>e.replaceBaseImage),c=(0,s.useCharacterWizardStore)(e=>e.baseImages),[d,u]=l.useState(null),m=l.useMemo(()=>Array.isArray(c)?c:[],[c]),h=l.useCallback(async e=>{let a=m.find(t=>t.id===e);if(a){u(e),o(e,{...a,url:"loading",thumbnailUrl:"loading"});try{await t(e,o,n,r)}catch(t){o(e,{...a,url:"failed",thumbnailUrl:"failed",error:t instanceof Error?t.message:"Regeneration failed"})}finally{u(null)}}},[t,o,n,r,m]),g=l.useCallback(async()=>{r&&(await t(r,o,n,r,a),i(""))},[r,a,t,o,n,i]),p=l.useMemo(()=>m.filter(e=>"skeleton"===e.url),[m]),x=l.useMemo(()=>m.some(e=>e.url&&"skeleton"!==e.url&&"loading"!==e.url&&(e.url.startsWith("http")||e.url.startsWith("data:"))),[m]);return{fineTuningImageId:d,safeBaseImages:m,skeletonImages:p,hasImages:x,selectedBaseImageId:r,baseImageFineTunePrompt:a,setBaseImageFineTunePrompt:i,selectBaseImage:n,handleRegenerateSingleImage:h,handleFineTuneAndRegenerate:g}}({handleRegenerateImage:v}),{missingJobIds:T}=function(e){let{isPromptBasedFlow:t,hasValidImages:r,isGenerating:a,isPolling:n,safeBaseImages:i,pollExistingJobs:o,handleGenerateAll:c}=e,d=(0,s.useCharacterWizardStore)(e=>e.form),u=(0,s.useCharacterWizardStore)(e=>e.baseImageAllJobIds),m=l.useRef(!1),h=l.useRef(!1);l.useEffect(()=>{if(h.current||m.current&&(a||n))return;let e=i.length>0&&i.every(e=>"skeleton"===e.url||"loading"===e.url);if(i.some(e=>"failed"===e.url||"error"===e.url),!(!r&&!a&&!n&&!m.current&&(0===i.length||e)))return;if(m.current=!0,t&&u&&u.length>0){o(u).catch(e=>{let t=e instanceof Error?e.message:String(e);t.includes("ERR_CONNECTION_REFUSED")||t.includes("Failed to fetch")||t.includes("NetworkError")||t.includes("Unable to connect")?h.current=!0:r||(m.current=!1)});return}let l=async()=>{try{await c()}catch(a){let e=a instanceof Error?a.message:String(a),t=e.includes("ERR_CONNECTION_REFUSED")||e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("Unable to connect");t&&e.includes("Unable to connect")?h.current=!0:t||r||(m.current=!1)}};t?d.promptInput?.trim()&&l():l()},[r,a,n,i,t,u,d.promptInput,o,c]);let g=l.useRef(a);return l.useEffect(()=>{r&&(m.current=!1,h.current=!1)},[r]),l.useEffect(()=>{let e=g.current;g.current=a,!e&&a&&h.current&&(h.current=!1,m.current=!1)},[a]),{missingJobIds:t&&(!u||0===u.length)&&!r&&!a&&!n}}({isPromptBasedFlow:e,hasValidImages:m,isGenerating:t,isPolling:r,safeBaseImages:C,pollExistingJobs:g,handleGenerateAll:k});return(0,a.jsxs)("div",{className:"flex flex-col items-center w-full",children:[(0,a.jsx)(x,{isGenerating:t,hasSkeletonImages:S.length>0,completedCount:o,expectedImageCount:h}),T&&(0,a.jsx)(f,{}),(0,a.jsx)(b,{images:C,expectedImageCount:h,selectedBaseImageId:z,fineTuningImageId:N,missingJobIds:T,onSelectImage:W,onRegenerateImage:A}),(0,a.jsx)(p,{selectedImageId:z,fineTunePrompt:R,onFineTunePromptChange:E,onRegenerate:M,isGenerating:t,fineTuningImageId:N}),(0,a.jsx)(w,{onRegenerateAll:()=>k(!0,!0),isGenerating:t,isRegeneratingAll:u}),(0,a.jsx)(y,{error:c,connectionError:d,onRetry:()=>k(!1,!0)}),(0,a.jsx)(j,{hasImages:I,isGenerating:t,hasImagesInStore:C.length>0,onGenerate:()=>k(!1,!0)})]})}r(237),r(53341)},11942:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(82790).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},15421:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(82790).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},81778:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(82790).Z)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]])},94483:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(82790).Z)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]])}}]);